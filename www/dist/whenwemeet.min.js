window.onerror=function(o,e,n,i,r){"string"==typeof o&&o.indexOf("Script error.")>-1||console.log("Error: ",o," Script: "+e+" Line: "+n+" Column: "+i+" StackTrace: "+r)},window.oncontextmenu=function(o){return o.preventDefault(),o.stopPropagation(),!1},$.fn.showSVGLogo=function(o){var e=$($("#wwm-svg-logo").html());return e.width(o||"100%"),this.prepend(e),this},$.fn.showCanvasLogo=function(o){var e=$($("#wwm-canvas-logo").html()),n=e[0],i=n.getContext("2d"),r=function(o,e,n,i,r){var t=e*(Math.sqrt(3)/2);o.fillStyle=r,o.beginPath(),o.moveTo(n,i-t/2),o.lineTo(n-e/2,i+t/2),o.lineTo(n+e/2,i+t/2),o.lineTo(n,i-t/2),o.shadowOffsetX=1,o.shadowOffsetY=3,o.shadowBlur=1,o.shadowColor="rgb(204, 204, 204)",o.fill()},t=function(o,e,n,i,r){var t=e*(Math.sqrt(3)/2);o.fillStyle=r,o.beginPath(),o.moveTo(n,i-t/2),o.lineTo(n-e,i-t/2),o.lineTo(n-e/2,i+t/2),o.lineTo(n,i-t/2),o.shadowOffsetX=1,o.shadowOffsetY=3,o.shadowBlur=1,o.shadowColor="rgb(204, 204, 204)",o.fill()};return r(i,50,n.width/2+13,n.height/2,"magenta"),t(i,50,n.width/2+7,n.height/2,"cyan"),r(i,50,n.width/2-16,n.height/2-49,"yellow"),t(i,50,n.width/2+36,n.height/2+49,"greenyellow"),e.width(o||"100%"),this.prepend(e),this};var eval_dust_string=function(o,e,n){var i;return"function"==typeof o&&(0===o.length?o=o():(i="",e.tap(function(o){return i+=o,""}).render(o,n).untap(),o=i)),o};dust.helpers||(dust.helpers={}),dust.helpers.repeat=function(o,e,n,i){var r,t;if(t=parseInt(eval_dust_string(i.times,o,e),10),null!==t&&!isNaN(t)){for(null!==e.stack.head&&(e.stack.head.$len=t),r=0;t>r;r++)null!==e.stack.head&&(e.stack.head.$idx=r),o=n.block(o,e.push(r,r,t));null!==e.stack.head&&(e.stack.head.$idx=0),null!==e.stack.head&&(e.stack.head.$len=0)}return o};var wwm=function(){"use strict";var o;return o=function(){wwm.model.initModule(),wwm.shell.initModule()},{initModule:o}}();wwm.model=function(){"use strict";var o,e,n,i,r,t,l,a,s,c,d,f,m,u,h;return o=function(o){var e=$.Deferred();return $.ajax("/join",{data:o,type:"post",contentType:"application/x-www-form-urlencoded;charset=utf-8"}).done(function(o){e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},e=function(o){var e=$.Deferred();return $.get("/rooms/"+o).done(function(o){0===o.length?e.reject("no_room"):e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},i=function(o){var e=$.Deferred();return $.get("/member/"+o).done(function(o){e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},r=function(o){var e=$.Deferred();return $.post("/search/"+o).done(function(o){0===o.length&&e.reject("no_room"),e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},t=function(o){var e,n=$.Deferred(),r=i(o.maker);return r.done(function(i){i.roomcount>=3?(e="방은 최대 세 개까지 만들 수 있습니다.",n.reject(e)):$.post("/addroom/"+o.rid,o).done(function(o){n.resolve(o)}).fail(function(o){console.log(o),n.reject(o)})}),r.fail(function(o){console.log(o),n.reject(o)}),n.promise()},l=function(o){var e=$.Deferred();return $.post("/enterroom/"+o.rid,o).done(function(o){console.log(o),e.resolve(o)}).fail(function(o){console.log(o),e.reject(o)}),e.promise()},s=function(o,e){var n=$.Deferred();return $.post("/ban/"+o,{rid:e}).done(function(o){console.log(o),n.resolve(o)}).fail(function(o){console.log(o),n.reject(o)}),n.promise()},c=function(o,e){var n=$.Deferred();return $.post("/changeroom/"+o,{title:e}).done(function(o){console.log(o),n.resolve(o)}).fail(function(o){console.log(o),n.reject(o)}),n.promise()},d=function(o,e){var n=$.Deferred();return $.post("/changeroom/"+o,{limit:e}).done(function(o){console.log(o),n.resolve(o)}).fail(function(o){console.log(o),n.reject(o)}),n.promise()},f=function(o){var e=$.Deferred(),n=o.rid;return o.day=JSON.stringify(o.day),o.night=JSON.stringify(o.night),console.log("confirm model",o),$.post("/confirm/"+n,o).done(function(o){console.log(o),e.resolve(o)}).fail(function(o){console.log("confirmerror",o),e.reject(o)}),e.promise()},m=function(o,e){var n,i=$.Deferred();return $.post("/deleteroom/"+o,{maker:e}).done(function(o){console.log(o),"no_room"===o&&(n="심각한 오류! 방장이 아닙니다.",i.reject(n)),i.resolve(o)}).fail(function(o){i.reject(o)}),i.promise()},n=function(o){var e,n=$.Deferred();return $.post("/roominfo/"+o).done(function(o){console.log(o),"no_room"===o&&(e="심각한 오류! 방장이 아닙니다.",n.reject(e)),n.resolve(o)}).fail(function(o){n.reject(o)}),n.promise()},u=function(o){var e=$.Deferred();return $.post("/introdone/"+o).done(function(o){console.log(o),e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},a=function(o){var e=$.Deferred();return $.post("/report",o).done(function(o){console.log(o),e.resolve(o)}).fail(function(o){e.reject(o)}),e.promise()},h=function(){localStorage.login?window.userInfo=JSON.parse(localStorage.login):window.userInfo={}},{initModule:h,createRoom:t,getRoomList:e,getUser:i,enterRoom:l,deleteRoom:m,ban:s,changeTitle:c,changeLimit:d,searchList:r,confirm:f,join:o,getRoomInfo:n,introDone:u,report:a}}(),wwm.shell=function(){"use strict";var o,e,n={$con:$("#whenwemeet"),$view:$("#view"),$modal:$("#modal"),$logo:$("#logo"),$intro:$("#intro")};return o=function(o){var e=o.originalEvent.state,n=e.mod;switch(console.log("onpopstate",n),n){case"login":window.userInfo=e.data,localStorage.login=JSON.stringify(e.data),localStorage.loginType=e.type,wwm.lobby.initModule();break;case"directlogin":wwm.login.initModule();break;case"lobby":wwm.lobby.initModule();break;case"intro":wwm.modal.initModule($("#wwm-intro").html());break;case"search":wwm.lobby.searchRoom(e.query);break;case"logout":delete window.userInfo,localStorage.removeItem("login"),localStorage.removeItem("loginType"),wwm.login.initModule();break;case"room":wwm.room.initModule(e.data,"enter");break;case"confirm":break;default:wwm.shell.initModule()}},e=function(){var e=localStorage.login&&JSON.parse(localStorage.login);console.log("login",localStorage.login),console.log("first",localStorage.first),$(window).on("popstate",o),e?(history.pushState({mode:"lobby",id:userInfo.id},"","/lobby/"+userInfo.id),wwm.lobby.initModule()):(history.pushState({mode:"directlogin"},"","/login"),wwm.login.initModule())},{initModule:e,view:n.$view,modal:n.$modal,logo:n.$logo,intro:n.$intro}}(),wwm.confirm=function(){"use strict";var o,e,n,i,r,t,l,a,s,c={};return e=function(e){o={$con:e,$toLobbyBtn:e.find("#to-lobby"),$toRoom:e.find("#to-room"),$toKakao:e.find("#result-to-kakao"),$toFacebook:e.find("#result-to-fb"),$result:e.find("#result")}},n=function(){var o,e,n=[[null,null]],i=[[null,null]],r=[[null,null]],t=[[null,null]],l=[[null,null]],a=[[null,null]],s=[[null,null]],d=[n,i,r,t,l,a,s];return console.log(c.dayArray,c.nightArray),d.forEach(function(n,i){for(e=0,o=0;12>o;o++)console.log(o,0===c.dayArray[o][i].length),0===c.dayArray[o][i].length&&(console.log(null===n[e][0]),null===n[e][0]?(n[e][0]=o,n[e][1]=n[e][0]+1):(console.log(n[e][1]===o),n[e][1]===o?n[e][1]=o+1:n[++e]=[o,o+1])),console.log(n,e);for(o=12;24>o;o++)0===c.nightArray[o-12][i].length&&(null===n[e][0]?(n[e][0]=o,n[e][1]=n[e][0]+1):n[e][1]===o?n[e][1]=o+1:n[++e]=[o,o+1]),console.log(n,e)}),d},i=function(e){var n="",i=["일","월","화","수","목","금","토"],r="";i.forEach(function(o,i){n+='<p class="result-date">'+o+"요일: </p>",e[i].forEach(function(o){return null===o[0]?!1:(o[0]<12?r="오전":12===o[0]?r="오후":(r="오후",o[0]-=12),n+=r+" "+o[0]+"시 ~ ",o[1]<12?r="오전":12===o[1]?r="오후":24===o[1]?(r="밤",o[1]-=12):(r="오후",o[1]-=12),void(n+=r+" "+o[1]+"시<br>"))})}),o.$result.html(n)},r=function(){o.$con.fadeOut("slow"),history.pushState({mod:"lobby"},"","/lobby/"+c.myInfo.id),wwm.lobby.initModule(o.$con)},t=function(){history.pushState({mod:"room"},"","/room/"+c.rid),o.$con.fadeOut("slow")},l=function(){console.log("kakao send")},a=function(){FB.ui({method:"send",link:"http%3A%2F%2Fwww.nytimes.com%2F2011%2F06%2F15%2Farts%2Fpeople-argue-just-to-win-scholars-assert.html"})},s=function(s){var d=$("#wwm-confirm").html();c=$.extend(c,s),console.log(s,c),wwm.shell.modal.html(d),e(wwm.shell.modal),i(n()),o.$toLobbyBtn.click(r),o.$toRoom.click(t),o.$toKakao.on({click:l,mouseover:function(){this.src="/kakaolink_btn_medium_ov.png"},mouseout:function(){this.src="/kakaolink_btn_medium.png"}}),o.$toFacebook.on({click:a,mouseover:function(){this.src="/facebook_invite_ov.png"},mouseout:function(){this.src="/facebook_invite.png"}}),o.$con.fadeIn("slow")},{initModule:s,info:c}}(),wwm.intro=function(){var o,e,n,i,r,t,l,a,s={},c={phase:0};return t=function(o){s={$con:o,$main:o.find("#intro-main"),$skip:o.find("#skip-intro"),$next:o.find(".next-phase")}},r=function(o,e){e?o.animate({right:"+=4"},500).animate({right:"-=4"},500,function(){r(o,!0)}):o.animate({bottom:"+=4"},500).animate({bottom:"-=4"},500,function(){r(o)})},a=function(){var o=c.phase||parseInt(s.$main.find("div").attr("class").slice(6),10);switch(o){case 0:s.$main.find(".intro-logo").showSVGLogo(100);break;case 1:r(s.$main.find("#arrow-to-modal"));break;case 2:s.$main.find("#intro-create-room, #arrow-to-create").css("left",.5*$(window).width()-50),r(s.$main.find("#arrow-to-create")),s.$con.css({height:"250px",bottom:0});break;case 3:s.$con.css({height:"50px",top:0}),r(s.$main.find("#arrow-to-confirm"),!0),s.$main.find(".intro-wrapper").css({background:"white",opacity:.9,top:"70%"});break;case 4:r(s.$main.find("#arrow-to-aside")),s.$main.find(".intro-wrapper").css({background:"white",opacity:.9,top:"125%"});break;case 5:r(s.$main.find("#arrow-to-result"),!0),s.$con.css({height:"50px"}),s.$main.find(".intro-wrapper").css({background:"white",opacity:.9,top:"50%"});break;case 6:s.$con.css({top:"auto",background:"white",textAlign:"center"}),s.$main.find(".intro-wrapper").css({background:"white",opacity:.9})}},n=function(){var o,e=++c.phase;console.log("toFirstPhase",e),o=$("#wwm-phase-"+e).html(),s.$main.html(o),a()},e=function(){console.log("skipIntro"),$(this).is(":checked")&&(localStorage.first="false",wwm.shell.intro.fadeOut("slow"),wwm.model.introDone(userInfo.id))},l=function(){localStorage.first="false",wwm.shell.intro.fadeOut("slow"),wwm.model.introDone(userInfo.id)},i=function(o){var e,i=(new Spinner).spin(),r=$("#room-title").val(),t=$("#room-limit").val(),l=$("#room-password").val(),a=userInfo.id.toString(),c=userInfo.picture,d={rid:(new Date).getTime().toString().slice(0,-4),title:r,maker:a,limit:t,picture:c,password:l,members:JSON.stringify([{id:userInfo.id,name:userInfo.name,picture:userInfo.picture,confirm:!1}])};return console.log("intro createroom",d),o.preventDefault(),s.$con.append(i.el),r?(console.log("createroom data",d),e=wwm.model.createRoom(d),e.done(function(o){console.log(o),d.current=1,wwm.room.initModule(d,"create"),wwm.shell.modal.fadeOut("slow")}),e.fail(function(o){console.log(o),alert("방 생성에러! 콘솔확인")}),e.always(function(){$(i.el).remove()}),void n()):($(i.el).remove(),void alert("제목을 입력하세요."))},o=function(){var o=$("#wwm-intro").html();wwm.shell.intro.html(o).fadeIn("slow"),t(wwm.shell.intro),a(),s.$skip.change(e),s.$next.click(n),s.$main.on("click","#intro-show-modal",function(){console.log("intro showModal"),wwm.modal.initModule($("#wwm-create-modal").html()),n()}),s.$main.on("click","#intro-create-room",i),s.$main.on("click","#intro-confirm",function(){wwm.room.confirmTable(userInfo.id,wwm.room.info.rid),n()}),s.$main.on("click","#intro-aside",function(){wwm.room.toggleAside(),setTimeout(wwm.room.toggleAside,3e3),n()}),s.$main.on("click","#intro-result",function(){wwm.lobby.showResult(wwm.room.info.rid),n()}),s.$main.on("click","#intro-end",function(){l()})},{initModule:o}}(),wwm.lobby=function(){"use strict";var o,e,n,i,r,t,l,a,s,c,d,f,m,u={socket:!1},h=io();return r=function(){wwm.modal.initModule($("#wwm-create-modal").html())},e=function(){var e=(new Spinner).spin(),n=wwm.model.getRoomList(userInfo.id);o.$list.append(e.el),n.done(function(o){i(o)}),n.fail(function(e){return"no_room"===e?void o.$list.html('<span class="info-message">방이 없습니다. +를 눌러 방을 만들어보세요.</span>'):(console.error(e),void o.$list.html(e.responseText))}),n.always(function(){$(e.el).remove()})},n=function(e){var n,r=e,t=(new Spinner).spin();return"string"!=typeof r&&(r=$(this).parent().prev().val().trim(),e.preventDefault()),""===r?void a():(history.pushState({mod:"search",query:r},"","/search/"+r),o.$list.append(t.el),n=wwm.model.searchList(r),n.done(function(o){i(o)}),n.fail(function(e){return"no_room"===e?void o.$list.html('<span class="info-message">검색 결과가 없습니다.</span>'):(console.error(e),void o.$list.html(e.responseText))}),void n.always(function(){$(t.el).remove()}))},i=function(e){var n,i,r,t,l=$(document.createDocumentFragment()),a=$("#wwm-room-list").html();e.forEach(function(o){n=dust.loadSource(dust.compile(a)),i=o.password||!1,r=!1,i&&o.members.some(function(o){return o.id===userInfo.id?r=!0:!1}),t={rid:o.rid,picture:o.picture,title:o.title,current:o.members.length,limit:o.limit,vacant:o.limit-o.members.length,result:o.result,password:i,unlocked:r},dust.render(n,t,function(o,e){o||l.append(e)})}),o.$list.html(l)},t=function(){console.info("logout"),history.pushState({mod:"logout"},"","/"),delete window.userInfo,localStorage.removeItem("login"),localStorage.removeItem("loginType"),wwm.login.initModule()},l=function(e){var n,i,r,t=$(this),l=(new Spinner).spin();return o.$list.append(l.el),"string"!=typeof e&&(e=$(this).data("rid"),$(this).has(".locked").length&&(r=prompt("비밀번호",""),null===r||""===r.trim()))?void $(l.el).remove():(i={rid:e,pw:r,pid:userInfo.id,name:userInfo.name,picture:userInfo.picture},n=wwm.model.enterRoom(i),n.done(function(o){return console.log(o),"no_room"===o?void alert("방이 없습니다"):"full"===o?void alert("방이 다 찼습니다."):"wrong_password"===o?void alert("비밀번호가 틀렸습니다."):"ban"===o?void alert("강퇴당한 방에는 들어갈 수 없습니다."):(o.current=t.find(".current").text(),console.info("enter room post result",o),history.pushState({mod:"room",data:o},"","/room/"+e),void wwm.room.initModule(o,"enter"))}),n.fail(function(o){console.error(o.responseText),alert("오류발생! 콘솔확인")}),void n.always(function(){$(l.el).remove()}))},a=function(){console.info("refreshlist"),e()},s=function(){var e=wwm.model.getUser(userInfo.id),n=JSON.parse(localStorage.login);e.done(function(e){o.$profilePicture.attr("src",e.picture),o.$profileName.text(e.name),userInfo.picture=e.picture,userInfo.name=e.name,n.picture=e.picture,n.name=e.name,localStorage.login=JSON.stringify(n)})},c=function(o){var e,n={};o?(e=wwm.model.getRoomInfo(o),e.done(function(e){"no_room"===e?alert("방이 없습니다"):(history.pushState({mod:"confirm"},"","/result/"+o),n.dayArray=e.day,n.nightArray=e.night,n.rid=e.rid,wwm.confirm.initModule(n))}),e.fail(function(o){console.error(o)})):(o=$(this).parent().data("rid"),history.pushState({mod:"confirm"},"","/result/"+o),wwm.confirm.initModule(n))},d=function(e){o={$con:e,$showCreateroom:e.find("#show-createroom-modal"),$searchroomBtn:e.find("#searchroom-btn"),$main:e.find("#lobby-main"),$list:e.find("#rooms"),$logout:e.find("#logout-btn"),$refresh:e.find("#refresh-list"),$refreshProfile:e.find("#refresh-profile"),$result:e.find(".result"),$profilePicture:e.find("#profile-picture"),$profileName:e.find("#profile-name")}},m=function(){u.socket||(h.on("titleChanged",function(o){var e=$(".room"),n=e.map(function(o,e){$(e).data("rid")}).get();n.every(function(n,i){return o.rid===n?(e.eq(i).find(".title").text(o.title),!1):!0})}),h.on("currentChanged",function(o){var e=$(".room"),n=e.map(function(o,e){$(e).data("rid")}).get();n.every(function(n,i){return o.rid===n?(e.eq(i).find(".current").text(o.number),!1):!0})}),h.on("limitChanged",function(o){var e=$(".room"),n=e.map(function(o,e){$(e).data("rid")}).get();n.every(function(n,i){return o.rid===n?(e.eq(i).find(".total").text(o.number),!1):!0})}),u.socket=!0)},f=function(){var i,f;localStorage.login||(history.pushState({mod:"login"},"","/login"),wwm.login.initModule()),localStorage.first||(localStorage.first="true"),f=JSON.parse(localStorage.first),f&&wwm.intro.initModule($("#wwm-intro").html()),window.userInfo||(window.userInfo=JSON.parse(localStorage.login)),i=$("#wwm-lobby").text(),dust.render(dust.loadSource(dust.compile(i)),{name:userInfo.name,picture:userInfo.picture},function(i,f){i?(console.error(i),alert("rendering error! 콘솔 확인")):(wwm.shell.view.html(f).fadeIn("slow"),d(wwm.shell.view),m(),o.$main.showSVGLogo("50%"),e(),o.$showCreateroom.click(r),o.$searchroomBtn.click(n),o.$logout.click(t),o.$refresh.click(a),o.$refreshProfile.click(s),o.$list.on("click",".room",l),o.$list.on("click",".result",c))})},{initModule:f,enterRoom:l,showResult:c,searchRoom:n,refreshList:a}}(),wwm.login=function(){"use strict";var o,e,n,i,r,t,l,a,s;return e=function(){var o={id:"123456789",name:"관리자",picture:"//graph.facebook.com/874512615962577/picture"},e=wwm.model.join(o);e.fail(function(o){alert("가입 오류 발생!"),console.log(o.responseText)}),history.pushState({mod:"login",data:o,type:"local"},"","/lobby/123456789"),window.userInfo=o,localStorage.login=JSON.stringify(o),localStorage.loginType="local",wwm.lobby.initModule(wwm.shell.view)},n=function(){var o={id:"987654321",name:"테스터",picture:"http://th-p.talk.kakao.co.kr/th/talkp/wkkZf8zHlk/lxr9VefTlrfUr7FAzsAgJk/ljh2mh_640x640_s.jpg"},e=wwm.model.join(o);e.fail(function(o){alert("가입 오류 발생!"),console.log(o.responseText)}),history.pushState({mod:"login",data:o,type:"local2"},"","/lobby/987654321"),window.userInfo=o,localStorage.login=JSON.stringify(o),localStorage.loginType="local2",wwm.lobby.initModule(wwm.shell.view)},i=function(){Kakao.Auth.login({success:function(){Kakao.API.request({url:"/v1/user/me",success:function(o){console.log(o),Kakao.API.request({url:"/v1/api/talk/profile",success:function(e){e=$.extend(e,o),l(e),console.log(e)},fail:function(o){alert(JSON.stringify(o))}})},fail:function(o){alert(JSON.stringify(o))}})},fail:function(o){alert(JSON.stringify(o))}})},l=function(o){var e;console.log(JSON.stringify(o)),o.name=o.nickName,o.picture=o.profileImageURL,o.thumb=o.thumbnailURL,e=wwm.model.join(o),e.fail(function(o){alert("가입 오류 발생!"),console.log(o.responseText)}),history.pushState({mod:"login",data:o,type:"kakao"},"","/lobby/"+o.id),window.userInfo=o,localStorage.login=JSON.stringify(o),localStorage.loginType="kakao",wwm.lobby.initModule(wwm.shell.view)},r=function(){FB.login(function(o){"connected"===o.status?FB.api("/me",a):"not_authorized"===o.status?alert("Please log log into this app."):alert("Please log into Facebook.")})},a=function(o){var e;console.log(JSON.stringify(o)),o.picture="//graph.facebook.com/"+o.id+"/picture",e=wwm.model.join(o),e.fail(function(o){alert("가입 오류 발생!"),console.log(o.responseText)}),history.pushState({mod:"login",data:o,type:"facebook"},"","/lobby/"+o.id),window.userInfo=o,localStorage.login=JSON.stringify(o),localStorage.loginType="facebook",wwm.lobby.initModule(wwm.shell.view)},t=function(e){o={$con:e,$logo:e.find("#login-logo"),$wrapper:e.find("#login-wrapper"),$kakaoLogin:e.find("#kakao-login-btn"),$fbLogin:e.find("#fb-login-btn"),$localhost:e.find("#localhost-login"),$localhost2:e.find("#localhost2-login")}},s=function(){wwm.shell.view.html($("#wwm-login").html()),t(wwm.shell.view),o.$logo.showSVGLogo(),o.$logo.animate({height:"70%"}),o.$wrapper.fadeIn("slow"),o.$kakaoLogin.on({click:i,mouseover:function(){this.src="/kakao_account_login_btn_medium_narrow_ov.png"},mouseout:function(){this.src="/kakao_account_login_btn_medium_narrow.png"}}),o.$fbLogin.on({click:r,mouseover:function(){this.src="/facebook_ov.png"},mouseout:function(){this.src="/facebook.png"}}),o.$localhost.click(e),o.$localhost2.click(n)},{initModule:s}}(),wwm.modal=function(){"use strict";var o,e,n,i,r,t;return e=function(e){o={$con:e,$close:e.find(".modal-close"),$roomTitle:e.find("#room-title"),$limit:e.find("#room-limit"),$password:e.find("#room-password"),$createRoom:e.find("#create-room-btn"),$reportTitle:e.find("#report-title"),$reportHidden:e.find("#report-hidden"),$reportContent:e.find("#report-content"),$report:e.find("#report-btn")}},n=function(o){o&&o.preventDefault(),wwm.shell.modal.fadeOut("slow")},i=function(e){var n,i=(new Spinner).spin(),r=o.$roomTitle.val().trim(),t=o.$limit.val(),l=o.$password.val().trim()||null,a=userInfo.id.toString(),s=userInfo.picture,c={rid:(new Date).getTime().toString().slice(0,-4),title:r,maker:a,limit:t,picture:s,password:l,members:JSON.stringify([{id:userInfo.id,name:userInfo.name,picture:userInfo.picture,confirm:!1}]),color:[a,null,null,null,null,null,null,null]};return e.preventDefault(),o.$con.append(i.el),r?(console.log("createroom data",c),n=wwm.model.createRoom(c),n.done(function(o){console.log(o),c.current=1,wwm.room.initModule(c,"create"),wwm.shell.modal.fadeOut("slow")}),n.fail(function(o){console.error(o),alert(o)}),void n.always(function(){$(i.el).remove()})):($(i.el).remove(),void alert("제목을 입력하세요."))},r=function(e){var i,r=o.$reportTitle.val().trim(),t=o.$reportContent.val().trim(),l={id:userInfo.id,rid:userInfo.rid,name:userInfo.name,title:r,content:t,date:(new Date).toString()};e.preventDefault(),i=wwm.model.report(l),i.done(function(o){alert("전송되었습니다. 빠른 시일 내에 조치하겠습니다."),console.log(o),n()}),i.fail(function(o){console.error(o),alert(o)})},t=function(t){wwm.shell.modal.html(t),e(wwm.shell.modal),wwm.shell.modal.fadeIn("slow"),o.$roomTitle.focus(),o.$close.click(n),o.$createRoom.click(i),o.$report.click(r)},{initModule:t}}(),wwm.room=function(){"use strict";var o,e,n,i,r,t,l,a,s,c,d,f,m,u,h,p,g,w,b,y,v,k,I,S,L,C,x,T,A,M,O,_,D,N,E,j,q,F,R,J,P,B,H,K={colorList:["red","orange","yellow","yellowgreen","skyblue","purple","violet","pink"],memberList:$("#wwm-member-list").text(),adminMenu:$("#wwm-admin-menu").text(),room:$("#wwm-room").text()},U={rid:null,maker:null,title:null,picture:null,limit:0,current:0,dayArray:null,nightArray:null,memberList:[],memberColor:[],myInfo:{confirm:!1,order:0},now:"day",event:!1,clickMod:null,currentCell:null,confirmCount:0},V=io();return N=function(o){var e=0;return U.memberColor.forEach(function(n,i){n===o&&(e=i)}),console.info("checkMyOrder",o,e),e},E=function(){var o=$(this).attr("class").split(" ")[1],e=U.myInfo.order;return $(this).hasClass("chosen")?void alert("이미 남이 선택한 색상입니다."):(U.memberColor[e]=null,K.colorList.every(function(e,n){return console.log(o+" "+e),o===e?(U.myInfo.order=n,U.memberColor[n]=userInfo.id,!1):!0}),V.emit("changeColor",{id:userInfo.id,name:userInfo.name,rid:U.rid,color:U.memberColor,orig:e,now:U.myInfo.order}),void console.info("changeColor"))},n=function(o){var e,i=new Array(o||0),r=[].slice.call(arguments,1);if(arguments.length>1)for(e=0;o>e;e++)i[e]=n.apply(this,r);else if(1===arguments.length)for(e=0;e<i.length;e++)i[e]=[];return i},i=function(o){var e,n=[];return o.forEach(function(o){e=[o.parentNode.rowIndex-1,o.cellIndex-1],n.push(e)}),console.info("cellToCoord",n),n},r=function(e,n,i,r){var t,l,a,s,c;console.info("coordListToTable",e,n,i,r),"day"===i?(l=o.$dayTable,t=U.dayArray):(l=o.$nightTable,t=U.nightArray),e.forEach(function(o){a=l.find("tr").eq(o[0]+1).find("td").eq(o[1]),c=t[o[0]][o[1]],r?(s=c.indexOf(n),-1===s&&c.push(n),n===U.myInfo.order?a.addClass("busy "+K.colorList[n]):a.addClass("busy")):(s=c.indexOf(n),s>-1&&c.splice(s,1),n===U.myInfo.order&&a.removeClass(K.colorList[n]),c.length||a.removeClass("busy")),t[o[0]][o[1]]=c})},t=function(e){var n,i=[U.dayArray,U.nightArray],r=[o.$dayTable,o.$nightTable],t=void 0===e?U.myInfo.order:e;console.info("renderTable",U.dayArray,U.nightArray),i.forEach(function(o,e){o.forEach(function(o,i){o.forEach(function(o,l){var a=r[e].find("tr").eq(i+1).find("td").eq(l);a.removeClass(),o.forEach(function(o){console.log(t,o),n=a.addClass("busy"),t===o&&n.addClass(K.colorList[o])})})})})},_=function(o){var e=[U.dayArray,U.nightArray];e.forEach(function(e){e.forEach(function(n,i){n.forEach(function(n,r){var t=n.indexOf(o);console.log(n,t),t>-1&&e[i][r].splice(t,1)})})}),console.log("removeSchedule",o,U.dayArray),t()},l=function(){console.info("showMembers",U.memberList),o.$memberList.find("ul").empty(),o.$toggleMember.empty(),U.memberList.forEach(function(e){var n=$("<img/>").attr("src",e.picture).width("100%"),i=$("<div/>").addClass("toggle-member").attr("data-id",e.id);i.append(n),o.$toggleMember.append(i),dust.render(dust.loadSource(dust.compile(K.memberList)),{id:e.id,color:K.colorList[N(e.id)],name:e.name,picture:e.picture,confirm:e.confirm},function(e,n){e?o.$memberList.find("ul").html(e):o.$memberList.find("ul").append(n)})}),a()},a=function(){var e;console.info("showOnline"),U.memberList.forEach(function(n,i){e=o.$memberList.find("li").eq(i),n.online?0!==e.has(".offline").length&&e.find(".offline").toggleClass("offline online"):0!==e.has(".online").length&&e.find(".online").toggleClass("online offline")})},D=function(o){var e={};return console.info("findInfo",o),U.memberList.every(function(n,i){return o===n.id?(e=n,e.idx=i,!1):!0}),e},s=function(o){var e,n;return"string"==typeof o?e=o:(e=$(this).prev().val(),o.preventDefault()),console.info("banPerson",arguments),e===U.maker?void alert("자기 자신을 강퇴시키면 안 되겠죠?"):(n=wwm.model.ban(e,U.rid),n.done(function(){_(D(e).order),V.emit("ban",{rid:U.rid,id:e,order:D(e).order,day:U.dayArray,night:U.nightArray})}),void n.fail(function(o){console.error(o),alert("퇴장당하지 않으려고 버티는중! 다시 시도하세요.")}))},c=function(e){var n=$(this).parent().prev().val(),i=wwm.model.changeTitle(U.rid,n);e.preventDefault(),console.info("changeTitle",n),i.done(function(){U.title=n,o.$roomTitle.text(n)}),i.fail(function(o){alert("제목 바꾸기 실패!"),console.error(o)})},d=function(e){var n,i=Number($(this).parent().prev().val());return e.preventDefault(),isNaN(i)?void alert("숫자를 입력해야 합니다."):(console.info("changeLiimit",i),i<U.current?void alert("현재 사람이 설정한 수보다 많습니다."):(n=wwm.model.changeLimit(U.rid,i),n.done(function(){var e,n=U.limit;if(U.limit=i,i>n)for(e=0;i-n>e;e++)o.$roomPeople.append('<i class="fa fa-child vacant"></i>');else for(e=0;n-i>e;e++)o.$roomPeople.find(".vacant").last().remove();$("#current-people-limit").val(U.limit)}),void n.fail(function(o){alert("인원수 바꾸기 실패!"),console.error(o)})))},f=function(e){console.info("changeCurrentNumber",e),U.current+=e,e>0?o.$roomPeople.find(".vacant").first().removeClass("vacant"):o.$roomPeople.find(".fa-child").not(".vacant").last().addClass("vacant")},b=function(o){var e=$(this);o.stopPropagation(),console.info("showAdminMenu",e.parent().hasClass("opened")),e.parent().hasClass("opened")?e.parent().removeClass("opened"):($(".opened").removeClass("opened"),e.parent().addClass("opened"))},y=function(){var e=U.rid;confirm("정말 방을 폭파하실 건가요?")&&(V.emit("explode",{rid:e,id:userInfo.id}),wwm.lobby.initModule(o.$con))},v=function(){return o.$confirm.hasClass("confirmed")?(alert("확정 상태가 해제됩니다."),o.$table.find("td").off("mouseover touchmove"),o.$confirm.removeClass("confirmed"),U.myInfo.confirm=!1,V.emit("confirmed",{id:userInfo.id,bool:!1}),!0):void 0},m=function(e){var n,i=this.cellIndex-1,r=[],t=!0,l=!1;if(!v()){if(console.info("onClickDay",i),o.$thDay.off("mouseover").on("mouseover",m),n="day"===U.now?U.dayArray:U.nightArray,-1===i){if(confirm("전체를 선택하거나 취소합니다."))return e.stopPropagation(),n.forEach(function(o,e){o.forEach(function(o,n){r.push([e,n]),!l&&o.indexOf(U.myInfo.order)>-1&&(l=!0)})}),console.log(l,r),void(l?V.emit("not-busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:r}):V.emit("busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:r}));o.$thTime.off("mouseover"),o.$thDay.off("mouseover")}n.forEach(function(o,e){-1===o[i].indexOf(U.myInfo.order)&&(t=!1,r.push([e,i]))}),t?(r=[],n.forEach(function(o,e){r.push([e,i])}),V.emit("not-busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:r})):V.emit("busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:r})}},g=function(){o.$thDay.off("mouseover")},u=function(){var e,n=this.parentNode.rowIndex-1,i=[],r=!0;if(!v()){if(console.info("onClickTime",n),o.$thTime.off("mouseover").on("mouseover",u),e="day"===U.now?U.dayArray:U.nightArray,-1===n)return void o.$thTime.off("mouseover");e[n].forEach(function(o,e){-1===o.indexOf(U.myInfo.order)&&(r=!1,i.push([n,e]))}),r?(i=[],e[n].forEach(function(o,e){i.push([n,e])}),V.emit("not-busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i})):V.emit("busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i})}},w=function(){o.$thTime.off("mouseover")},h=function(e){var n,r;if(o.$table.find("td").off("mouseover touchmove").on("mouseover touchmove",h),!v())if(n="day"===U.now?U.dayArray:U.nightArray,r=n[this.parentNode.rowIndex-1][this.cellIndex-1],console.info("onclickCell",this.parentNode.rowIndex-1,this.cellIndex-1,e.type),U.currentCell||(U.currentCell=r),"busy"===U.clickMod){if(("mouseover"===e.type||"touchmove"===e.type)&&U.currentCell===r)return;U.currentCell=r,V.emit("busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i([this])})}else if("not-busy"===U.clickMod){if(("mouseover"===e.type||"touchmove"===e.type)&&U.currentCell===r)return;U.currentCell=r,V.emit("not-busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i([this])})}else console.log(n,r,r.length,r.indexOf(U.myInfo.order)>-1),r.length&&r.indexOf(U.myInfo.order)>-1?(U.clickMod="not-busy",V.emit("not-busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i([this])})):(U.clickMod="busy",V.emit("busy",{rid:U.rid,cur:U.now,sid:U.myInfo.order,arr:i([this])}))},p=function(){o.$table.find("td").off("mouseover touchmove"),U.clickMod=null,U.currentCell=null},M=function(){var e=o.$chatWrap,n=o.$chatList;e.hasClass("minified")?(e.removeClass("minified"),e.css({height:"100px"}),n.css({height:"100px"}),n.animate({scrollTop:n[0].scrollHeight},"slow"),$(this).toggleClass("fa-chevron-down fa-chevron-up")):(e.addClass("minified"),e.css({height:"20px"}),n.css({height:"20px"}),n.animate({scrollTop:n[0].scrollHeight},"slow"),$(this).toggleClass("fa-chevron-down fa-chevron-up"))},k=function(){console.info("toLobby",U.rid),o.$confirm.hasClass("confirmed")?(history.pushState({mod:"lobby"},"","/lobby/"+userInfo.id),V.emit("out",{id:userInfo.id,rid:U.rid,order:U.myInfo.order}),wwm.lobby.initModule(o.$con)):confirm("확정 버튼을 누르지 않고 나가면 저장되지 않은 사항은 사라집니다.")&&(history.pushState({mod:"lobby"},"","/lobby/"+userInfo.id),V.emit("out",{id:userInfo.id,rid:U.rid,order:U.myInfo.order}),wwm.lobby.initModule(o.$con)),userInfo.rid=null},I=function(){var e,n,i;if(1===U.current){if(!confirm("혼자 있을 때 방을 나가면 방이 사라집니다.그래도 나가시겠습니까?"))return;i=wwm.model.deleteRoom(U.rid,userInfo.id),i.done(function(){wwm.lobby.initModule(o.$con)}),i.fail(function(o){console.error(o),alert("방 삭제 실패!")})}else if(U.maker===userInfo.id){if(!confirm("지금 나가면 방장이 다른 사람에게 넘어갑니다."))return;e=U.memberList[1].id,n=U.memberList[1].picture,history.replaceState({mod:"lobby"},"","/lobby/"+userInfo.id),_(U.myInfo.order),V.emit("delegate",{id:userInfo.id,order:U.myInfo.order,rid:U.rid,admin:e,picture:n,day:U.dayArray,night:U.nightArray})}else{if(!confirm("정말 나가시겠습니까? 잠시 나가는 거면 로비 버튼을 클릭하세요."))return;history.replaceState({mod:"lobby"},"","/lobby/"+userInfo.id),_(U.myInfo.order),V.emit("quit",{id:userInfo.id,order:U.myInfo.order,rid:U.rid,day:U.dayArray,night:U.nightArray})}console.info("quit",U.rid),userInfo.rid=null,wwm.lobby.initModule(o.$con)},A=function(o){var e=$(this).parent().prev().val();o.preventDefault(),console.info("sendChat",userInfo.id,e),V.emit("chat",{id:userInfo.id,name:userInfo.name,order:U.myInfo.order,text:e,rid:U.rid})},O=function(){console.info("refresh",{rid:U.rid,id:userInfo.id}),V.on("responseArr",function(o){console.info("socket responseArr"),U.dayArray=o.day,U.nightArray=o.night,t()}),V.emit("requestArr",{rid:U.rid,id:userInfo.id})},q=function(){var e,n={};n.id=userInfo.id,n.rid=U.rid,n.bool=!U.myInfo.confirm,n.day=U.dayArray,n.night=U.nightArray,console.info(n.id,"change confirm to",n.bool,n),e=wwm.model.confirm(n),e.done(function(){o.$confirm.toggleClass("confirmed"),U.myInfo.confirm=n.bool,V.emit("confirmed",{id:userInfo.id,bool:n.bool,rid:U.rid})}),e.fail(function(o){console.error(o),alert("confirm error!")})},T=function(){"day"===U.now?(U.now="night",o.$dayTable.hide(),o.$nightTable.show()):(U.now="day",o.$dayTable.show(),o.$nightTable.hide()),$(this).find("div").toggleClass("tapped")},j=function(){var e=$(this),n=e.data("id").toString();o.$toggleMember.find(".toggle-member").removeClass("chosen"),e.addClass("chosen"),
console.info("toggleMember",n,N(n)),t(N(n))},F=function(){console.info("toConfirmPage",U),history.pushState({mod:"confirm"},"","/result/"+U.rid),wwm.confirm.initModule(U)},R=function(){Kakao.Link.createTalkLinkButton({container:"#kakao-invite",label:"카카오링크 샘플에 오신 것을 환영합니다.",image:{src:"http://dn.api1.kage.kakao.co.kr/14/dn/btqaWmFftyx/tBbQPH764Maw2R6IBhXd6K/o.jpg",width:"300",height:"200"},webButton:{text:"우리 언제 만나",url:"http://whenwemeet.herokuapp.com"},fail:function(){alert("KakaoLink is currently only supported in iOS and Android platforms.")}})},J=function(){FB.ui({method:"send",link:"http%3A%2F%2Fwww.nytimes.com%2F2011%2F06%2F15%2Farts%2Fpeople-argue-just-to-win-scholars-assert.html"})},P=function(){console.info("toggleAside",o.$aside.hasClass("opened")),o.$aside.hasClass("opened")?(o.$aside.removeClass("opened"),o.$aside.css("left","-100%")):(o.$aside.addClass("opened"),o.$aside.css("left","0"))},B=function(){var o=$(this);return console.info("showMemberMenu",U.maker===userInfo.id),U.maker!==userInfo.id?!1:void(o.has(".ban-this-btn").length||(o.append('<span class="ban-this-btn">강퇴</span>'),setTimeout(function(){o.find(".ban-this-btn").fadeOut("slow").remove()},5e3)))},S=function(){wwm.modal.initModule($("#wwm-report").html())},x=function(e){o.$chatList.append('<p><span class="'+K.colorList[e.order]+'-text">'+D(e.id).name+"님이 퇴장하셨습니다.</span></p>"),o.$chatList.animate({scrollTop:o.$chatList[0].scrollHeight},"slow"),U.memberList.forEach(function(o,n){return o.id===e.id?(U.memberList.splice(n,1),!1):!0}),U.dayArray=e.day,U.nightArray=e.night,f(-1),l(),t()},L=function(){console.info("handleEvent",U.event),U.event||(V.on("out",function(e){U.memberList.every(function(o){return o.id===e.id?(o.online=!1,!1):!0}),a(),o.$chatList.append('<p><span class="'+K.colorList[e.order]+'-text">'+D(e.id).name+"님이 오프라인입니다.</span></p>"),o.$chatList.animate({scrollTop:o.$chatList[0].scrollHeight},"slow"),console.info("socket out",U.memberList)}),V.on("quit",function(o){x(o),console.info("socket quit",U.memberList)}),V.on("delegate",function(e){x(e),o.$chatList.append('<p><span class="'+D(e.admin).color+'-text">'+D(e.admin).name+"님이 이제 방장입니다.</span></p>"),U.maker=e.admin,U.picture=e.picture,o.$picture.attr("src",U.picture),userInfo.id===e.admin&&dust.render(dust.loadSource(dust.compile(K.adminMenu)),{admin:!0},function(e,n){e?console.error(e):o.$admin.replaceWith(n)}),console.info("socket delegate",U.memberList)}),V.on("newMember",function(e){console.log("already?",e.alreadyMember),e.alreadyMember||U.memberList.push({id:e.id,name:e.name,confirm:!1,picture:e.picture}),console.info("socket newmember",e),U.memberList[D(e.id).idx].online=!0,V.emit("uptodateArr",{sid:e.socket,day:U.dayArray,id:userInfo.id,rid:U.rid,night:U.nightArray,order:U.myInfo.order,online:D(userInfo.id).idx}),console.log(D(userInfo.id).idx,U.current,D(userInfo.id).idx>=U.current),D(userInfo.id).idx>=U.current&&f(1),o.$chatList.append('<p><span class="'+K.colorList[e.order]+'-text">'+e.name+"님이 입장하셨습니다.</span></p>"),o.$chatList.animate({scrollTop:o.$chatList[0].scrollHeight},"slow"),l(),a()}),V.on("uptodateArr",function(o){console.info("socket uptodateArr"),U.dayArray=o.day,U.nightArray=o.night,U.memberList[o.online].online=!0,U.memberColor[o.order]=o.id,a(),t()}),V.on("chat",function(e){console.info("socket chat",e.id,e.text),o.$chatList.append('<p><span class="'+K.colorList[e.order]+'-text">'+e.name+"</span>: "+e.text+"</p>"),o.$chatbox.val("").focus(),o.$chatList.animate({scrollTop:o.$chatList[0].scrollHeight},"slow")}),V.on("busy",function(o){console.info("socket busy:",o.arr,o.sid,o.cur),r(o.arr,o.sid,o.cur,!0)}),V.on("not-busy",function(o){console.info("socket notbusy:",o.arr,o.sid,o.cur),r(o.arr,o.sid,o.cur,!1)}),V.on("requestArr",function(o){console.info("socket requestArr"),V.emit("responseArr",{sid:o.sid,day:U.dayArray,night:U.nightArray})}),V.on("ban",function(e){return console.info("socket ban",e.id,e.order),U.myInfo.order===e.order?(alert("강퇴당하셨습니다..."),wwm.lobby.initModule(o.$con),void(userInfo.rid=null)):(U.myInfo.order>e.order&&U.myInfo.order--,alert(D(e.id).name+"님이 강제퇴장 되었습니다. 잘가요!"),U.memberList.every(function(o,n){return e.id===o.id?(U.memberList.splice(n,1),!1):!0}),f(-1),U.dayArray=e.day,U.nightArray=e.night,l(),void t())}),V.on("confirmed",function(e){var n=0;U.memberList.forEach(function(o){o.id===e.id&&(o.confirm=e.bool),o.confirm===!0&&n++}),n===U.memberList.length?o.$allConfirmed.show():o.$allConfirmed.hide(),console.log(o.$memberList.find("[data-id="+e.id+"]")),e.bool?o.$memberList.find("[data-id="+e.id+"]").find(".member-confirmed").show():o.$memberList.find("[data-id="+e.id+"]").find(".member-confirmed").hide(),console.info("socket confirmed",n)}),V.on("explode",function(){alert("방이 폭파되었습니다. 로비로 이동합니다."),wwm.lobby.initModule(o.$con),console.info("socket explode")}),V.on("changeColor",function(e){var n=K.colorList[e.orig],i=K.colorList[e.now],r=[U.dayArray,U.nightArray];o.$roomTitle.removeClass(n+"-text").addClass(i+"-text"),console.log(e,o.$memberList.find("[data-id="+e.id+"]"),"."+n+"-text"),o.$memberList.find("[data-id="+e.id+"]").find("."+n+"-text").removeClass().addClass(i+"-text"),o.$changeColor.eq(e.orig).removeClass("chosen"),o.$changeColor.eq(e.now).addClass("chosen"),o.$chatList.append('<p><span class="'+i+'-text">'+e.name+"</span>님이 색깔을 바꾸셨습니다.</p>"),r.forEach(function(o){o.forEach(function(o){o.forEach(function(o){console.log(o),o.forEach(function(n,i){n===e.orig&&(o[i]=e.now)})})})}),t(),console.info("socket"+e.id+" changed color from"+n+"to"+i)}),U.event=!0)},e=function(e){o={$con:e,$picture:e.find("#room-header img"),$table:e.find("#day-table, #night-table"),$dayTable:e.find("#day-table"),$nightTable:e.find("#night-table"),$thDay:e.find("#day-table tr:first-child, #night-table tr:first-child").find("th"),$thTime:e.find("#day-table, #night-table").find("tr").find("th:first-child"),$memberList:e.find("#member-list"),$toggleTable:e.find("#toggle-table"),$toLobbyBtn:e.find("#back-to-lobby"),$quitBtn:e.find("#quit"),$admin:e.find("#manage-btn, #invite-btn"),$explodeRoom:e.find("#explode-room"),$changeLimit:e.find("#change-limit-btn"),$changeTitle:e.find("#change-room-title"),$changeColor:e.find("#change-color").find(".color-option"),$toggleMember:e.find("#toggle-member"),$roomTitle:e.find("#title"),$report:e.find("#report-error"),$roomPeople:e.find("#room-people-info"),$sendChat:e.find("#send-chat"),$chatbox:e.find("#chatbox"),$chatWrap:e.find("#chat-wrapper"),$chatList:e.find("#chat-list"),$chatToggler:e.find(".chat-toggler"),$confirm:e.find("#confirm-calendar"),$refresh:e.find("#refresh-calendar"),$allConfirmed:e.find("#all-confirmed"),$kakaoInvite:e.find("#kakao-invite"),$fbInvite:e.find("#fb-invite"),$aside:e.find("#room-aside"),$asideFooter:e.find("#aside-footer"),$asideToggler:e.find("#show-aside, #close-aside")}},C=function(o){U.rid=o.rid.toString(),U.maker=o.maker.toString(),U.title=o.title,U.limit=parseInt(o.limit,10),U.picture=o.picture,userInfo.rid=U.rid,U.dayArray=o.day||n(12,7),U.nightArray=o.night||n(12,7),console.info("initiating room #"+U.rid,U.dayArray,U.nightArray),U.memberList=Array.isArray(o.members)?o.members:JSON.parse(o.members),U.current=U.memberList.length,U.memberColor=o.color,U.memberList.forEach(function(o){o.confirm===!0&&U.confirmCount++,o.id===userInfo.id&&(o.online=!0,U.myInfo.confirm=o.confirm)}),U.myInfo.order=N(userInfo.id)},H=function(n){console.log(n);var i;C(n),i={name:userInfo.name,title:U.title,current:U.current,limit:U.limit,members:U.memberList,picture:U.picture,vacant:U.limit-U.current,confirm:U.myInfo.confirm,allConfirmed:U.confirmCount===U.memberList.length,color:K.colorList[U.myInfo.order]},userInfo.id===U.maker&&(i.admin=!0),dust.render(dust.loadSource(dust.compile(K.room)),i,function(r,a){return r?void wwm.shell.view.html(r):(wwm.shell.view.html(a),void dust.render(dust.loadSource(dust.compile(K.adminMenu)),i,function(i,r){return i?void wwm.shell.view.html(i):(wwm.shell.view.find("#aside-footer").prepend(r),e(wwm.shell.view),t(),U.memberColor.forEach(function(e,n){null!==e&&o.$changeColor.eq(n).addClass("chosen")}),l(),L(),V.emit("enter",{id:userInfo.id,rid:U.rid,name:userInfo.name,order:U.myInfo.order,picture:userInfo.picture,alreadyMember:n.alreadyMember}),o.$table.find("td").on("mousedown",h),o.$table.find("td").on("mouseup",p),o.$thDay.mousedown(m),o.$thDay.mouseup(g),o.$thTime.mousedown(u),o.$thTime.mouseup(w),o.$explodeRoom.click(y),o.$toLobbyBtn.click(k),o.$toggleTable.click(T),o.$toggleMember.on("click",".toggle-member",j),o.$admin.click(b),o.$changeLimit.click(d),o.$changeTitle.click(c),o.$changeColor.click(E),o.$sendChat.click(A),o.$memberList.on("click","li",B),o.$memberList.on("click",".ban-this-btn",function(){var o=$(this).parent().data("id");s(o.toString())}),o.$confirm.click(q),o.$chatToggler.click(M),o.$refresh.click(O),o.$allConfirmed.click(F),o.$quitBtn.click(I),o.$asideToggler.click(P),o.$report.click(S),o.$kakaoInvite.on({click:R,mouseover:function(){this.src="/kakaolink_btn_medium_ov.png"},mouseout:function(){this.src="/kakaolink_btn_medium.png"}}),void o.$fbInvite.on({click:J,mouseover:function(){this.src="/facebook_invite_ov.png"},mouseout:function(){this.src="/facebook_invite.png"}}))}))})},{initModule:H,info:U,confirmTable:q,toggleAside:P,showOnlineStatus:a,showMembers:l,renderTable:t}}();